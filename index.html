<!DOCTYPE html>
<!--
  I, Matthew Szczerba, student number 000737180, certify that all code submitted is my own work; that I have not copied it from any other source. 
  I also certify that I have not allowed my work to be copied by others.
-->
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>Beaches Niagara</title>
    <style>
        .navbar {
            margin-bottom: 0;
        }

        #expandButton{
            color:black;
        }

        #headerTitle{
            margin-top:10px;
            color:white;
        }

        li{
            color:white;
        }

        #searchTerm{
            width:475px;
            padding:none;
            margin-top:0px;
        }

        #search{
            margin-right:100px;
        }

        #searchIcon,#clearIcon{
            margin-bottom:10px;
        }

        #clearIcon{
            visibility: hidden;
        }
        
        .dropdown-menu-item {
            color: black;
            display: block;
            padding-left: 20px;
            width: 100%;
            text-align: left;
            font-weight: normal;
        }

        body{
            font-size:2.0em;
        }

        .navbar-nav > li > .dropdown-menu { 
            background-color: #2c3e50;
            }
        
        .navbar-nav > li > .dropdown-menu > label{
            color:white;         
            }
        
        .navbar-default .navbar-nav > .open > a, .navbar-default .navbar-nav > .open > a:focus, .navbar-default .navbar-nav > .open > a:hover{
            background-color:#6495ed;
        }
        
        .navbar-form .checkbox, .navbar-form .radio .dropdown-menu-item{
            color:white;
        }
        

        @media only screen and (max-width:1750px){
                #search{
                margin-right:300px;
            }
        }
        
        @media only screen and (max-width:1714px){
                #search{
                margin-right:0px;
            }

            #searchTerm{
                width:350px;
            }
        }

        @media only screen and (max-width:768px){
                #search{
                margin-right:100%;
            }
                   
            #searchTerm{
                width:250px;
            }

            .dropdown-menu-item{
                margin-left:15px;
            }

            #searchIcon{
                display: none;
            }
        }

    
    </style>
</head>
<body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://www.bing.com/api/maps/mapcontrol?key=AkaMh3hQ1dPnUAmodTspSEFH62lWB3wCq2Pozu4N8P8MwYBncZH_fGL5F2a8iAmk&amp;callback=loadMapScenario" async="false" defer=""></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/js/bootstrap-select.min.js"></script>
    <nav id="theNav" class="navbar navbar-default navbar-fixed-top" style="background-color: #2c3e50;">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a id="headerTitle" class="navbar-brand" href="#" style=font-size:1.5em;>Beaches Niagara</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <form class="navbar-form" id="searchBar">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" style="color:white;">Municipalities<span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Grimsby')" autocomplete="off" />
                                        Grimsby
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Fort Erie')" autocomplete="off" />
                                        Fort Erie
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Lincoln')" autocomplete="off" />
                                        Lincoln
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Wainfleet')" autocomplete="off" />
                                        Wain Fleet
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Niagara-on-the-Lake')" autocomplete="off" />
                                        Niagara-On-The-Lake
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('St. Catharines')" autocomplete="off" />
                                        St.Catharines
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Port Colborne')" autocomplete="off" />
                                        Port Colborne
                                    </label>
                                </li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" style="color:white;">Water Body<span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Lake Ontario')" autocomplete="off" />
                                        Lake Ontario
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Lake Erie')" autocomplete="off" />
                                        Lake Erie
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Niagara River')" autocomplete="off" />
                                        Niagara River
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Dils Lake')" autocomplete="off" />
                                        Dils Lake
                                    </label>
                                </li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" style="color:white;">Ownership<span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Public')" autocomplete="off" />
                                        Public
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Private')" autocomplete="off" />
                                        Private
                                    </label>
                                </li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false" style="color:white;">Ammenities<span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Parking')" autocomplete="off" />
                                        Parking
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Washrooms')" autocomplete="off" />
                                        Washrooms
                                    </label>
                                </li>
                                <li>
                                    <label class="dropdown-menu-item checkbox">
                                        <input type="checkbox" onclick="onFilter('Garbage')" autocomplete="off" />
                                        Garbage
                                    </label>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </form>
                <form id="searchField" class="navbar-form navbar-right" action="search" method="post">
                    <div id="search" class='input-group'>
                        <input id="searchTerm" type="search" placeholder="Search for a beach" class="form-control">
                        <span class="input-group-btn">
                            <button id="searchIcon" type='submit' class='btn btn-default'>
                                <span class='glyphicon glyphicon-search'></span>
                            </button>
                            <button id="clearIcon" type='button' class='btn btn-default' onClick="clearAll()">
                                <span class='glyphicon glyphicon-remove'></span>
                            </button>
                        </span>
                        <input type="submit" value="Search" style="visibility: hidden;" />
                    </div>
                </form>
            </div>
        </div>
    </nav>
    <div id="beachMap" class="col-md-6" style="position:absolute; width:100%; height:100%;">
        <div id="directionsSectionMobile"></div>
    </div>
    <div id="directionsSection" style="max-height:100vh; overflow-y: auto;"></div>
    <script>
       var loadedBeaches=[];var geoLoaded=!1;var userLat;var userLong;$(document).ready(function(){getJson();function getJson(){fetch("https://niagaraopendata.ca/dataset/1ca52a3b-03a9-412f-a10a-59ddab0743c5/resource/15db2b16-abe9-469f-9441-80fc3e355b8d/download/beaches.json").then((resp)=>resp.json()).then(function(data){var i;for(i=0;i<data.features.length;i++){var toStringit=JSON.stringify(data.features[i])
        var response=JSON.parse(toStringit);loadedBeaches.push(response)}})}});var loadedMap;function loadMapScenario(){getLocation();var map=new Microsoft.Maps.Map(document.getElementById('beachMap'),{center:new Microsoft.Maps.Location(43.0582,-79.2902)});Microsoft.Maps.loadModule('Microsoft.Maps.Directions',function(){directionsManager=new Microsoft.Maps.Directions.DirectionsManager(loadedMap)});loadedMap=map;infobox=new Microsoft.Maps.Infobox(loadedMap.getCenter(),{visible:!1});infobox.setMap(loadedMap);if(loadedBeaches.length===0){setTimeout(loadMapScenario,500)}
        placePins(loadedBeaches)}
        function getLocation(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(showPosition,showError)}else{userLocation.innerHTML="Geolocation is not supported by this browser."}}
        function showPosition(position){var location=new Microsoft.Maps.Location(position.coords.latitude,position.coords.longitude);var pin=new Microsoft.Maps.Pushpin(location,{color:'green'});pin.metadata={title:"Current Location"}
        Microsoft.Maps.Events.addHandler(pin,'click',pushpinClicked);loadedMap.entities.push(pin);loadedMap.setView({center:location});geoLoaded=!0;userLat=position.coords.latitude;userLong=position.coords.longitude}
        function showError(){geoLoaded=!1}
        var filterTerms=[];function onFilter(filter){if($.inArray(filter,filterTerms)==-1){filterTerms.push(filter)}
        else{filterTerms.splice($.inArray(filter,filterTerms),1)}
        clearAll();
        onApplyFilter(filterTerms)}
        function onApplyFilter(filters){for(var i=loadedMap.entities.getLength()-1;i>=0;i--){var pushpin=loadedMap.entities.get(i);if(pushpin instanceof Microsoft.Maps.Pushpin&&pushpin.metadata.title!="Current Location"){loadedMap.entities.removeAt(i)}}
        infobox.setMap(loadedMap);var filteredBeaches=[];if(filters.length>0){document.getElementById("clearIcon").style.visibility="visible";for(i=0;i<filters.length;i++){for(x=0;x<loadedBeaches.length;x++){var beachValues=[loadedBeaches[x].properties.BEACH_MUNICIPALITY,loadedBeaches[x].properties.BEACH_BODY_WATER,loadedBeaches[x].properties.BEACH_TYPE]
        if($.inArray(filters[i],beachValues)!=-1&&$.inArray(loadedBeaches[x],filteredBeaches)==-1){filteredBeaches.push(loadedBeaches[x])}
        else if(filters[i]=="Parking"){beachValues.push(loadedBeaches[x].properties.BEACH_PARKING)
        if($.inArray("Yes",beachValues)!=-1&&$.inArray(loadedBeaches[x],filteredBeaches)==-1)
        filteredBeaches.push(loadedBeaches[x])}
        else if(filters[i]=="Washrooms"){beachValues.push(loadedBeaches[x].properties.BEACH_WASHROOM)
        if($.inArray("Yes",beachValues)!=-1&&$.inArray(loadedBeaches[x],filteredBeaches)==-1)
        filteredBeaches.push(loadedBeaches[x])}
        else if(filters[i]=="Garbage"){beachValues.push(loadedBeaches[x].properties.BEACH_GARBAGE)
        if($.inArray("Yes",beachValues)!=-1&&$.inArray(loadedBeaches[x],filteredBeaches)==-1)
        filteredBeaches.push(loadedBeaches[x])}
        else if(filters[i]=="Public"){if($.inArray("Public Beach",beachValues)!=-1||$.inArray("Park",beachValues)!=-1||$.inArray("Road Allowance",beachValues)!=-1&&$.inArray(loadedBeaches[x],filteredBeaches)==-1)
        filteredBeaches.push(loadedBeaches[x])}}}}
        else{filteredBeaches=loadedBeaches}
        placePins(filteredBeaches)}
        $("#searchField").submit(function(){onSearch($("#searchTerm").get(0));return!1});function onSearch(searchTerm){if(typeof searchTerm!="string"){var searchTerm=searchTerm.value}
        $("#checkbox").prop("checked",!1);searchTerm=searchTerm.toLowerCase();$('#searchTerm').val('');for(var i=loadedMap.entities.getLength()-1;i>=0;i--){var pushpin=loadedMap.entities.get(i);if(pushpin instanceof Microsoft.Maps.Pushpin&&pushpin.metadata.title!="Current Location"){loadedMap.entities.removeAt(i)}}
        infobox.setMap(loadedMap);if(searchTerm!=""){document.getElementById("clearIcon").style.visibility="visible";var filteredBeaches=[];for(x=0;x<loadedBeaches.length;x++){if(loadedBeaches[x].properties.BEACH_MUNICIPALITY.toLowerCase().includes(searchTerm)){filteredBeaches.push(loadedBeaches[x])}
        else if(loadedBeaches[x].properties.BEACH_NAME.toLowerCase().includes(searchTerm)){filteredBeaches.push(loadedBeaches[x])}
        else if(loadedBeaches[x].properties.BEACH_BODY_WATER.toLowerCase().includes(searchTerm)){filteredBeaches.push(loadedBeaches[x])}
        else if(loadedBeaches[x].properties.BEACH_TYPE.toLowerCase().includes(searchTerm)){filteredBeaches.push(loadedBeaches[x])}}
        placePins(filteredBeaches)}
        else{placePins(loadedBeaches)}}
        function clearAll(){placePins(loadedBeaches);directionsManager.clearAll();document.getElementById("beachMap").style.left="0px";document.getElementById("clearIcon").style.visibility="hidden";document.getElementById("beachMap").style.height="100%";document.getElementById("beachMap").style.width="100%";document.getElementById("directionsSection").style.marginTop="0px";$('input[type=checkbox]').prop('checked',!1);filterTerms=[]}
        function placePins(beaches){loadedMap.layers.clear();var filteredBeaches=beaches;for(i=0;i<filteredBeaches.length;i++){var location=new Microsoft.Maps.Location(filteredBeaches[i].geometry.coordinates[1],filteredBeaches[i].geometry.coordinates[0]);if(filteredBeaches[i].properties.BEACH_TYPE=="Private"){var pin=new Microsoft.Maps.Pushpin(location,{color:'red'})}
        else if(filteredBeaches[i].properties.BEACH_TYPE=="Unknown"){var pin=new Microsoft.Maps.Pushpin(location,{color:'orange'})}
        else{var pin=new Microsoft.Maps.Pushpin(location,{color:'blue'})}
        pin.metadata={title:filteredBeaches[i].properties.BEACH_NAME,description:'<img src="images/'+filteredBeaches[i].properties.BEACH_NAME+'.jpg" alt='+filteredBeaches[i].properties.BEACH_NAME+'height=100 width=100> <br>'+'<strong>Body of water:</strong> '+filteredBeaches[i].properties.BEACH_BODY_WATER+'<br>'+" <strong>"+filteredBeaches[i].properties.BEACH_TYPE+"</strong> "+'<br>'+'<strong>Ammenities Available:</strong> '+'Garbage: '+filteredBeaches[i].properties.BEACH_GARBAGE+'<br> Parking: '+filteredBeaches[i].properties.BEACH_PARKING+'<br> Washroom: '+filteredBeaches[i].properties.BEACH_WASHROOM,lat:filteredBeaches[i].geometry.coordinates[1],long:filteredBeaches[i].geometry.coordinates[0]};Microsoft.Maps.Events.addHandler(pin,'click',pushpinClicked);loadedMap.entities.push(pin)}}
        function pushpinClicked(e){if(e.target.metadata){if(e.target.metadata.title=="Current Location"){infobox.setOptions({location:e.target.getLocation(),title:e.target.metadata.title,description:"",visible:!0})}else if(geoLoaded){infobox.setOptions({location:e.target.getLocation(),title:e.target.metadata.title,description:e.target.metadata.description+'<br>'+'<button id="directions" type="button" class="btn btn-primary btn-block" onclick="getDirections('+e.target.metadata.lat+','+e.target.metadata.long+')">Directions</button>',visible:!0,maxWidth:200,maxHeight:550})}
        else if(geoLoaded===!1){infobox.setOptions({location:e.target.getLocation(),title:e.target.metadata.title,description:e.target.metadata.description+'<br>'+'<button id="directions" type="button" class="btn btn-primary btn-block" disabled>Directions Disabled</button>',visible:!0,maxWidth:200,maxHeight:550})}}}
        function getDirections(lat,long){loadedMap.layers.clear();Microsoft.Maps.loadModule('Microsoft.Maps.Directions',function(){directionsManager=new Microsoft.Maps.Directions.DirectionsManager(loadedMap);var usersWaypoint=new Microsoft.Maps.Directions.Waypoint({location:new Microsoft.Maps.Location(userLat,userLong)});directionsManager.addWaypoint(usersWaypoint);var beach=new Microsoft.Maps.Directions.Waypoint({location:new Microsoft.Maps.Location(lat,long)});directionsManager.addWaypoint(beach);if($(window).width()>768){document.getElementById("beachMap").style.left="363px";document.getElementById("beachMap").style.width="81%";document.getElementById("beachMap").style.height="93.5%";document.getElementById("directionsSection").style.marginTop="60px";document.getElementById("directionsSection").style.height="93vh";directionsManager.setRenderOptions({itineraryContainer:'#directionsSection'});directionsManager.calculateDirections()}
        else{document.getElementById("directionsSectionMobile").style.position="fixed";document.getElementById("directionsSectionMobile").style.position="absolute";document.getElementById("directionsSectionMobile").style.marginTop=$(window).height()+"px";directionsManager.setRenderOptions({itineraryContainer:'#directionsSectionMobile'});directionsManager.calculateDirections()}
        document.getElementById("clearIcon").style.visibility="visible"})}
    </script>
</body>

</html>
